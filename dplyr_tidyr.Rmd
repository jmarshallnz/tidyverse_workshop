---
title: 'The tidyverse: Introduction to dplyr and tidyr'
author: "Jonathan Marshall"
output: html_document
---

```{r}
library(readxl)
library(dplyr)
years1 = excel_sheets('Student-rolls-by-School-2000-2008b.xlsx')
a1 = lapply(years1, function(x) { read_excel('Student-rolls-by-School-2000-2008b.xlsx', skip=3, sheet=x) %>% mutate(Year = x) %>% filter(!is.na(`School ID`)) })
years2 = excel_sheets('Student-rolls-by-School-2009-2017b.xlsx')
a2 = lapply(years2, function(x) { read_excel('Student-rolls-by-School-2009-2017b.xlsx', skip=3, sheet=x) %>% mutate(Year = x) %>% filter(!is.na(`School ID`)) })
all = bind_rows(a1, a2)

# yay, this looks like everything, saved the values with zero in it. Let's do some checking though
all = read_excel('~/Massey/Roll-by-FYL-and-Ethnic-Group-2007-2017_fullsheet.xlsx', sheet="all_data")
schools = all %>% select(`School: ID`, `School: Name`:`Region: MOE Local office`, -`School: Decile`) %>% unique
schools %>% select(`School: ID`, `School: Name`) %>% unique() %>% group_by(`School: Name`) %>% mutate(count = n()) %>% filter(count > 1)
```

Find the shit that's common to all schools